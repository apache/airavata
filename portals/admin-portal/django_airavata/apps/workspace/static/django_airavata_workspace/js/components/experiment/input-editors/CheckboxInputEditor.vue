<template>
  <!-- stop propagation of native input events so that they don't conflict with
  native input events generated by web component wrappers -->
  <b-form-checkbox-group
    :id="id"
    :checked="selectedOptions"
    :options="checkboxOptions"
    stacked
    :state="componentValidState"
    :disabled="readOnly"
    @input="selectionsChanged"
    @input.native.stop
  />
</template>

<script>
import { InputEditorMixin } from "django-airavata-workspace-plugin-api";

const CONFIG_OPTION_TEXT_KEY = "text";
const CONFIG_OPTION_VALUE_KEY = "value";

export default {
  name: "checkbox-input-editor",
  mixins: [InputEditorMixin],
  props: {
    value: {
      type: String,
    },
    options: {
      type: Array,
      default: null,
    },
  },
  computed: {
    checkboxOptions: function () {
      // passed in options take precedence over options in input metadata
      const options = this.options || this.editorConfig.options || [];
      return options.map((option) => {
        return {
          text: option[CONFIG_OPTION_TEXT_KEY],
          value: option[CONFIG_OPTION_VALUE_KEY],
        };
      });
    },
    selectedOptions() {
      return this.data ? this.data.split(",") : [];
    },
  },
  methods: {
    selectionsChanged(values) {
      this.data = values && values.length > 0 ? values.join(",") : null;
      this.valueChanged();
    },
  },
};
</script>
