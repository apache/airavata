# Generated by Django 3.2.11 on 2022-06-16 18:31

from django.db import migrations

from django_airavata.apps.auth.models import (
    USER_PROFILE_COMPLETED_TEMPLATE,
)


def default_templates(apps, schema_editor):

    EmailTemplate = apps.get_model("django_airavata_auth", "EmailTemplate")
    user_profile_completed_template = EmailTemplate(
        template_type=USER_PROFILE_COMPLETED_TEMPLATE,
        subject="User {{first_name}} {{last_name}} ({{username}}) has completed their profile",
        body="""
            <p>Gateway Portal: {{http_host}}</p>
            <p>Tenant: {{gateway_id}}</p>
            <h3>User Profile</h3>
            <p>Username: {{username}}</p>
            <p>Name: {{first_name}} {{last_name}}</p>
            <p>Email: {{email}}</p>
            {% if extended_profile_values %}
            <h3>Extended User Profile</h3>
            <table><tr><th>Name</th><th>Value</th></tr>
            {% for value in extended_profile_values %}
                <tr><td>{{ value.ext_user_profile_field.name }}</td>
                {% if value.value_display_list and value.value_display_list|length > 1 %}
                <td><ul>
                    {% for display_item in value.value_display_list %}
                    <li>{{ display_item }}</li>
                    {% endfor %}
                </ul></td>
                {% elif value.value_display_list and value.value_display_list|length == 1 %}
                <td>{{ value.value_display_list|first }}</td>
                {% else %}
                <td>{{ value.value_display_list }}</td>
                {% endif %}
                </tr>
            {% endfor %}
            </table>
            {% endif %}
        """.strip())
    user_profile_completed_template.save()


class Migration(migrations.Migration):

    dependencies = [
        ('django_airavata_auth', '0016_extendeduserprofilefield_required'),
    ]

    operations = [
        migrations.RunPython(default_templates)
    ]
