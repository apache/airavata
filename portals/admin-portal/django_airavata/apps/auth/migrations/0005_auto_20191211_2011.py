# -*- coding: utf-8 -*-
# Generated by Django 1.11.21 on 2019-12-11 20:11
from __future__ import unicode_literals

from django.db import migrations, models

from django_airavata.apps.auth.models import USER_ADDED_TO_GROUP_TEMPLATE


def default_templates(apps, schema_editor):

    EmailTemplate = apps.get_model("django_airavata_auth", "EmailTemplate")
    user_added_to_group_template = EmailTemplate(
        template_type=USER_ADDED_TO_GROUP_TEMPLATE,
        subject="You've been added to group{{ group_names|length|pluralize }} [{{group_names|join:'] and ['}}] in {{portal_title}}",
        body="""
        <p>
        Dear {{first_name}} {{last_name}},
        </p>

        <p>
        Your user account (username {{username}}) has been added to the
        group{{ group_names|length|pluralize }} {{group_names|join:' and '}}.
        {{portal_title}} uses groups to share applications and experiments.
        </p>

        <p>
        You may have access to additional applications now that you are a
        member of {{group_names|join:' and '}}. To check what applications you
        have access to, please check: <a href="{{dashboard_url}}">{{dashboard_url}}</a>.
        </p>

        <p>
        You may also have access to additional experiments. To check what
        experiments you have access to, please check: <a
        href="{{experiments_url}}">{{experiments_url}}</a>.
        </p>

        <p>
        Please let us know if you have any questions.  Thanks.
        </p>
        """.strip())
    user_added_to_group_template.save()


def delete_default_templates(apps, schema_editor):
    EmailTemplate = apps.get_model("django_airavata_auth", "EmailTemplate")
    EmailTemplate.objects.filter(
        template_type=USER_ADDED_TO_GROUP_TEMPLATE).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('django_airavata_auth', '0004_password_reset_request'),
    ]

    operations = [
        migrations.AlterField(
            model_name='emailtemplate',
            name='template_type',
            field=models.IntegerField(choices=[(1, 'Verify Email Template'), (2, 'New User Email Template'), (3, 'Password Reset Email Template'), (4, 'User Added to Group Template')], primary_key=True, serialize=False),
        ),
        migrations.RunPython(default_templates,
                             reverse_code=delete_default_templates)
    ]
