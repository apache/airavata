
CREATE TABLE IF NOT EXISTS EXPERIMENT(
    EXPERIMENT_ID VARCHAR (255),
    PROJECT_ID VARCHAR (255),
    GATEWAY_ID VARCHAR (255),
    EXPERIMENT_TYPE VARCHAR (255),
    USER_ID VARCHAR (255),
    EXPERIMENT_NAME VARCHAR (255),
    CREATION_TIME BIGINT,
    DESCRIPTION VARCHAR (255),
    EXECUTION_ID VARCHAR (255),
    GATEWAY_EXECUTION_ID VARCHAR (255),
    GATEWAY_INSTANCE_ID VARCHAR (255),
    ENABLE_EMAIL_NOTIFICATION TINYINT,
    PRIMARY KEY (EXPERIMENT_ID),
    FOREIGN KEY (PROJECT_ID) REFERENCES PROJECT(PROJECT_ID),
    FOREIGN KEY (GATEWAY_ID) REFERENCES GATEWAY(GATEWAY_ID),
    FOREIGN KEY (USER_ID) REFERENCES USER_PROFILE(USER_ID)
)

CREATE TABLE IF NOT EXISTS EXPERIMENT_EMAIL (
    EXPERIMENT_ID VARCHAR (255),
    EMAIL VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID, EMAIL),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS USER_CONFIGURATION(
    EXPERIMENT_ID VARCHAR (255),
    AIRAVATA_AUTO_SCHEDULE TINYINT,
    OVERRIDE_MANUAL_SCHEDULED_PARAMS TINYINT,
    THROTTLE_RESOURCE TINYINT,
    USER_DN VARCHAR (255),
    GENERATE_CERT TINYINT,
    STORAGE_ID VARCHAR (255),
    EXPERIMENT_DATA_DIR VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
)

CREATE TABLE IF NOT EXISTS COMPUTE_RESOURCE_SCHEDULING(
    EXPERIMENT_ID VARCHAR (255),
    RESOURCE_HOST_ID VARCHAR (255),
    CPU_COUNT INT,
    NODE_COUNT INT,
    NUMBER_OF_THREADS INT,
    QUEUE_NAME VARCHAR (255),
    WALL_TIME_LIMIT INT,
    TOTAL_PHYSICAL_MEMORY INT,
    CHESSIS_NUMBER VARCHAR (255),
    STATIC_WORKING_DIRECTORY VARCHAR (255),
    OVERRIDE_LOGIN_USERNAME VARCHAR (255),
    OVERRIDE_SCRATCH_LOCATION VARCHAR (255),
    OVERRIDE_ALLOCATION_PROJECT_NUMBER VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES USER_CONFIGURATION(EXPERIMENT_ID)
)

CREATE TABLE IF NOT EXISTS EXPERIMENT_INPUT(
    EXPERIMENT_ID VARCHAR (255),
    INPUT_NAME VARCHAR (255),
    INPUT_VALUE VARCHAR (255),
    INPUT_TYPE VARCHAR (255),
    APPLICATION_ARGUMENT VARCHAR (255),
    STANDARD_INPUT TINYINT,
    USER_FRIENDLY_DESCRIPTION VARCHAR (255),
    METADATA VARCHAR (4096),
    INPUT_ORDER INT,
    REQUIRED TINYINT,
    REQUIRED_TO_ADDED_TO_COMMANDLINE TINYINT,
    DATA_STAGED TINYINT,
    STORAGE_RESOURCE_ID VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID,INPUT_NAME),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPERIMENT(EXPERIMENT_ID)
)

CREATE TABLE IF NOT EXISTS EXPERIMENT_OUTPUT(
    EXPERIMENT_ID VARCHAR (255),
    OUTPUT_NAME VARCHAR (255),
    OUTPUT_VALUE VARCHAR (255),
    OUTPUT_TYPE VARCHAR (255),
    APPLICATION_ARGUMENT (255),
    REQUIRED TINYINT,
    REQUIRED_TO_ADDED_TO_COMMANDLINE TINYINT,
    DATA_MOVEMENT TINYINT,
    LOCATION VARCHAR (255),
    SEARCH_QUERY VARCHAR (255),
    OUTPUT_STREAMING TINYINT,
    STORAGE_RESOURCE_ID VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID,OUTPUT_NAME),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPERIMENT(EXPERIMENT_ID)
)

CREATE TABLE IF NOT EXISTS EXPERIMENT_ERROR(
    ERROR_ID VARCHAR (255),
    EXPERIMENT_ID VARCHAR (255),
    CREATION_TIME BIGINT,
    ACTUAL_ERROR_MESSAGE VARCHAR (255),
    USER_FRIENDLY_MESSAGE VARCHAR (255),
    TRANSIENT_OR_PERSISTENT TINYINT,
    PRIMARY KEY (ERROR_ID),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPERIMENT(EXPERIMENT_ID)
)

CREATE TABLE IF NOT EXISTS EXPERIMENT_ERROR_ROOT_CAUSE_ERROR_ID(
    ERROR_ID VARCHAR (255),
    ROOT_CAUSE_ERROR_ID VARCHAR (255),
    PRIMARY KEY (ERROR_ID, ROOT_CAUSE_ERROR_ID),
    FOREIGN KEY(ERROR_ID) REFERENCES EXPERIMENT_ERROR(ERROR_ID)
)