
CREATE TABLE IF NOT EXISTS EXPCAT_EXPERIMENT(
    EXPERIMENT_ID VARCHAR (255),
    PROJECT_ID VARCHAR (255),
    GATEWAY_ID VARCHAR (255),
    EXPERIMENT_TYPE VARCHAR (255),
    USER_NAME VARCHAR (255),
    EXPERIMENT_NAME VARCHAR (255),
    CREATION_TIME BIGINT,
    DESCRIPTION VARCHAR (255),
    EXECUTION_ID VARCHAR (255),
    GATEWAY_EXECUTION_ID VARCHAR (255),
    GATEWAY_INSTANCE_ID VARCHAR (255),
    ENABLE_EMAIL_NOTIFICATION TINYINT(1),
    PRIMARY KEY (EXPERIMENT_ID),
    FOREIGN KEY (PROJECT_ID) REFERENCES WORKSPACE_PROJECT(PROJECT_ID) ON DELETE CASCADE,
    FOREIGN KEY (GATEWAY_ID) REFERENCES WORKSPACE_GATEWAY(GATEWAY_ID) ON DELETE CASCADE,
    FOREIGN KEY (USER_NAME) REFERENCES WORKSPACE_USER_PROFILE(AIRAVATA_INTERNAL_USER_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_EXPERIMENT_EMAIL (
    EXPERIMENT_ID VARCHAR (255),
    EMAIL VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID, EMAIL),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_USER_CONFIGURATION(
    EXPERIMENT_ID VARCHAR (255),
    AIRAVATA_AUTO_SCHEDULE TINYINT(1),
    OVERRIDE_MANUAL_SCHEDULED_PARAMS TINYINT(1),
    THROTTLE_RESOURCE TINYINT(1),
    USER_DN VARCHAR (255),
    GENERATE_CERT TINYINT(1),
    STORAGE_ID VARCHAR (255),
    EXPERIMENT_DATA_DIR VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_COMPUTE_RESOURCE_SCHEDULING(
    EXPERIMENT_ID VARCHAR (255),
    RESOURCE_HOST_ID VARCHAR (255),
    CPU_COUNT INT,
    NODE_COUNT INT,
    NUMBER_OF_THREADS INT,
    QUEUE_NAME VARCHAR (255),
    WALL_TIME_LIMIT INT,
    TOTAL_PHYSICAL_MEMORY INT,
    CHESSIS_NUMBER VARCHAR (255),
    STATIC_WORKING_DIRECTORY VARCHAR (255),
    OVERRIDE_LOGIN_USERNAME VARCHAR (255),
    OVERRIDE_SCRATCH_LOCATION VARCHAR (255),
    OVERRIDE_ALLOCATION_PROJECT_NUMBER VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_USER_CONFIGURATION(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_EXPERIMENT_INPUT(
    EXPERIMENT_ID VARCHAR (255),
    INPUT_NAME VARCHAR (255),
    INPUT_VALUE VARCHAR (255),
    INPUT_TYPE VARCHAR (255),
    APPLICATION_ARGUMENT VARCHAR (255),
    STANDARD_INPUT TINYINT(1),
    USER_FRIENDLY_DESCRIPTION VARCHAR (255),
    METADATA VARCHAR (4096),
    INPUT_ORDER INT,
    REQUIRED TINYINT(1),
    REQUIRED_TO_ADDED_TO_COMMANDLINE TINYINT(1),
    DATA_STAGED TINYINT(1),
    STORAGE_RESOURCE_ID VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID,INPUT_NAME),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_EXPERIMENT_OUTPUT(
    EXPERIMENT_ID VARCHAR (255),
    OUTPUT_NAME VARCHAR (255),
    OUTPUT_VALUE VARCHAR (255),
    OUTPUT_TYPE VARCHAR (255),
    APPLICATION_ARGUMENT VARCHAR (255),
    REQUIRED TINYINT(1),
    REQUIRED_TO_ADDED_TO_COMMANDLINE TINYINT(1),
    DATA_MOVEMENT TINYINT(1),
    LOCATION VARCHAR (255),
    SEARCH_QUERY VARCHAR (255),
    OUTPUT_STREAMING TINYINT(1),
    STORAGE_RESOURCE_ID VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID,OUTPUT_NAME),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_EXPERIMENT_ERROR(
    ERROR_ID VARCHAR (255),
    EXPERIMENT_ID VARCHAR (255),
    CREATION_TIME BIGINT,
    ACTUAL_ERROR_MESSAGE VARCHAR (255),
    USER_FRIENDLY_MESSAGE VARCHAR (255),
    TRANSIENT_OR_PERSISTENT TINYINT,
    PRIMARY KEY (ERROR_ID, EXPERIMENT_ID),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_EXPERIMENT_ERROR_ROOT_CAUSE_ERROR_ID(
    ERROR_ID VARCHAR (255),
    ROOT_CAUSE_ERROR_ID VARCHAR (255),
    PRIMARY KEY (ERROR_ID, ROOT_CAUSE_ERROR_ID),
    FOREIGN KEY(ERROR_ID) REFERENCES EXPCAT_EXPERIMENT_ERROR(ERROR_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_EXPERIMENT_STATUS(
    EXPERIMENT_ID VARCHAR (255),
    STATE VARCHAR (255),
    TIME_OF_STATE_CHANGE BIGINT,
    REASON VARCHAR (255),
    PRIMARY KEY (EXPERIMENT_ID, STATE),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS(
    PROCESS_ID VARCHAR (255),
    EXPERIMENT_ID VARCHAR (255),
    CREATION_TIME BIGINT,
    LAST_UPDATE_TIME BIGINT,
    PROCESS_DETAIL VARCHAR (255),
    APPLICATION_INTERFACE_ID VARCHAR (255),
    APPLICATION_DEPLOYMENT_ID VARCHAR (255),
    COMPUTE_RESOURCE_ID VARCHAR (255),
    TASK_DAG VARCHAR (255),
    GATEWAY_EXECUTION_ID VARCHAR (255),
    ENABLE_EMAIL_NOTIFICATION TINYINT(1),
    STORAGE_RESOURCE_ID VARCHAR (255),
    USER_DN VARCHAR (255),
    GENERATE_CERT VARCHAR (255),
    EXPERIMENT_DATA_DIR VARCHAR (255),
    USER_NAME VARCHAR (255),
    PRIMARY KEY (PROCESS_ID),
    FOREIGN KEY (EXPERIMENT_ID) REFERENCES EXPCAT_EXPERIMENT(EXPERIMENT_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS_EMAIL (
    PROCESS_ID VARCHAR (255),
    EMAIL VARCHAR (255),
    PRIMARY KEY (PROCESS_ID, EMAIL),
    FOREIGN KEY (PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS_RESOURCE_SCHEDULING(
    PROCESS_ID VARCHAR (255),
    RESOURCE_HOST_ID VARCHAR (255),
    CPU_COUNT INT,
    NODE_COUNT INT,
    NUMBER_OF_THREADS INT,
    QUEUE_NAME VARCHAR (255),
    WALL_TIME_LIMIT INT,
    TOTAL_PHYSICAL_MEMORY INT,
    CHESSIS_NUMBER VARCHAR (255),
    STATIC_WORKING_DIRECTORY VARCHAR (255),
    OVERRIDE_LOGIN_USERNAME VARCHAR (255),
    OVERRIDE_SCRATCH_LOCATION VARCHAR (255),
    OVERRIDE_ALLOCATION_PROJECT_NUMBER VARCHAR (255),
    PRIMARY KEY (PROCESS_ID),
    FOREIGN KEY (PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS_INPUT(
    PROCESS_ID VARCHAR (255),
    INPUT_NAME VARCHAR (255),
    INPUT_VALUE VARCHAR (255),
    INPUT_TYPE VARCHAR (255),
    APPLICATION_ARGUMENT VARCHAR (255),
    STANDARD_INPUT TINYINT(1),
    USER_FRIENDLY_DESCRIPTION VARCHAR (255),
    METADATA VARCHAR (4096),
    INPUT_ORDER INT,
    REQUIRED TINYINT(1),
    REQUIRED_TO_ADDED_TO_COMMANDLINE TINYINT(1),
    DATA_STAGED TINYINT(1),
    STORAGE_RESOURCE_ID VARCHAR (255),
    PRIMARY KEY (PROCESS_ID,INPUT_NAME),
    FOREIGN KEY (PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS_OUTPUT(
    PROCESS_ID VARCHAR (255),
    OUTPUT_NAME VARCHAR (255),
    OUTPUT_VALUE VARCHAR (255),
    OUTPUT_TYPE VARCHAR (255),
    APPLICATION_ARGUMENT VARCHAR (255),
    REQUIRED TINYINT(1),
    REQUIRED_TO_ADDED_TO_COMMANDLINE TINYINT(1),
    DATA_MOVEMENT TINYINT(1),
    LOCATION VARCHAR (255),
    SEARCH_QUERY VARCHAR (255),
    OUTPUT_STREAMING TINYINT(1),
    STORAGE_RESOURCE_ID VARCHAR (255),
    PRIMARY KEY (PROCESS_ID,OUTPUT_NAME),
    FOREIGN KEY (PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS_ERROR(
    ERROR_ID VARCHAR (255),
    PROCESS_ID VARCHAR (255),
    CREATION_TIME BIGINT,
    ACTUAL_ERROR_MESSAGE VARCHAR (255),
    USER_FRIENDLY_MESSAGE VARCHAR (255),
    TRANSIENT_OR_PERSISTENT TINYINT,
    PRIMARY KEY (ERROR_ID, PROCESS_ID),
    FOREIGN KEY (PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS_ERROR_ROOT_CAUSE_ERROR_ID(
    ERROR_ID VARCHAR (255),
    ROOT_CAUSE_ERROR_ID VARCHAR (255),
    PRIMARY KEY (ERROR_ID, ROOT_CAUSE_ERROR_ID),
    FOREIGN KEY(ERROR_ID) REFERENCES EXPCAT_PROCESS_ERROR(ERROR_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_PROCESS_STATUS(
    PROCESS_ID VARCHAR (255),
    STATE VARCHAR (255),
    TIME_OF_STATE_CHANGE BIGINT,
    REASON VARCHAR (255),
    PRIMARY KEY (PROCESS_ID, STATE),
    FOREIGN KEY (PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_TASK(
    TASK_ID VARCHAR (255),
    TASK_TYPE VARCHAR (255),
    PARENT_PROCESS_ID VARCHAR (255),
    CREATION_TIME BIGINT,
    LAST_UPDATE_TIME BIGINT,
    TASK_DETAIL VARCHAR (255),
    SUB_TASK_MODEL BLOB,
    PRIMARY KEY (TASK_ID),
    FOREIGN KEY (PARENT_PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID)
);

CREATE TABLE IF NOT EXISTS EXPCAT_TASK_ERROR(
    ERROR_ID VARCHAR (255),
    TASK_ID VARCHAR (255),
    CREATION_TIME BIGINT,
    ACTUAL_ERROR_MESSAGE VARCHAR (255),
    USER_FRIENDLY_MESSAGE VARCHAR (255),
    TRANSIENT_OR_PERSISTENT TINYINT,
    PRIMARY KEY (ERROR_ID, TASK_ID),
    FOREIGN KEY (TASK_ID) REFERENCES EXPCAT_TASK(TASK_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_TASK_STATUS(
    TASK_ID VARCHAR (255),
    STATE VARCHAR (255),
    TIME_OF_STATE_CHANGE BIGINT,
    REASON VARCHAR (255),
    PRIMARY KEY (TASK_ID, STATE),
    FOREIGN KEY (TASK_ID) REFERENCES EXPCAT_TASK(TASK_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EXPCAT_JOB(
    JOB_ID VARCHAR (255),
    TASK_ID VARCHAR (255),
    PROCESS_ID VARCHAR (255),
    JOB_DESCRIPTION VARCHAR (255),
    CREATION_TIME BIGINT,
    COMPUTE_RESOURCE_CONSUMED VARCHAR (255),
    JOB_NAME VARCHAR (255),
    WORKING_DIR VARCHAR (255),
    STDOUT TEXT,
    STDERR TEXT,
    EXIT_CODE INT(11),
    PRIMARY KEY(JOB_ID),
    FOREIGN KEY(TASK_ID) REFERENCES EXPCAT_TASK(TASK_ID),
    FOREIGN KEY(PROCESS_ID) REFERENCES EXPCAT_PROCESS(PROCESS_ID)
);

CREATE TABLE IF NOT EXISTS EXPCAT_JOB_STATUS(
    JOB_ID VARCHAR (255),
    STATE VARCHAR (255),
    TIME_OF_STATE_CHANGE BIGINT,
    REASON VARCHAR (255),
    PRIMARY KEY (JOB_ID, STATE),
    FOREIGN KEY (JOB_ID) REFERENCES EXPCAT_JOB(JOB_ID) ON DELETE CASCADE
);