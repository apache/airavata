#
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#

---
- name: include credentials
  include_vars: vars/openstack-credentials.yml

- name: create openstack instance(s)
  os_server:
    state: present
    auth:
      auth_url: "{{os_auth_url}}"
      username: "{{os_username}}"
      password: "{{os_password}}"
      project_name: "{{os_project_name}}"

    name: "{{item}}"
    region_name: "{{os_region_name}}"
    image: "{{centos7_gc_image}}"
    key_name: "{{key_name}}"
    timeout: 200
    flavor: "{{flavor_id}}"

    nics:
      - net-name: "{{network_name}}"
    security_groups: "{{security_group}}"
    floating_ip_pools: "{{floating_ip_pool}}"
  
  with_items:
    - test_ansible_1
    - test_ansible_2
